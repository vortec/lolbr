<html>
<head>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = false;

        function $(id) {
            return document.getElementById(id);
        }

        var handlers = {
            'CONNECT': function(data) {
                $('log').innerHTML = $('log').innerHTML + data['nickname'] + ' hat den Raum betreten.<br/>';
            },

            'MESSAGE': function(data) {
                $('log').innerHTML = $('log').innerHTML + data['nickname'] + ' sagt: ' + data['text'] + '<br/>';
            }
        }

        function submit() {
            var text = $('input').value;
            socket.emit('MESSAGE', {'text': text});
        }

        function connect() {
            var host = window.location.hostname;
            socket = io.connect('http://' + host);

            for (var event in handlers) {
                socket.on(event, handlers[event]);
            }

            var room = 'foobar';
            var nickname = 'user' + (parseInt(Math.random()*10) * parseInt(Math.random()*10))
            nickname = prompt('What\'s your name brah?', name);
            $('nickname').innerHTML = nickname;
            
            socket.emit('CONNECT', {'room': room, 'nickname': nickname});
        }


    </script>
</head>
<body onload="connect()">

    <h1>Hello, <span id="nickname"></span>!</h1>

    <input id="input" type="text" />
    <input id="submit" type="submit" onclick="submit()" />

    <div id="log">
    </div>



</body>
</html>
